<!doctype html>
<html class="no-js" lang="en">

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>raindrop.py</title>
        <link rel="stylesheet" href="/static/css/foundation.min.css" />
        <link rel="stylesheet" href="/static/css/jquery.growl.css" />
        <script src="/static/js/vendor/modernizr.js"></script>
    </head>

    <body>

        {% set conditions = ['Rain', 'Mostly Cloudy', 'Snow', 'Sunny', 'Windy'] %}

        <audio src="" id="player"></audio>
        <div class="previewsContainer" style="display:none"></div>

        <div style="height:3em"></div>

        <div class="row">

            <center><h2 id="info"></h2></center>

        </div>

        <div style="height:1em"></div>
        <hr>

        <div class="row">

            <div class="large-12 columns">

                <ul class="large-block-grid-3">

                    {% for condition in conditions %}

                    <li>
                        <div style="border: 1px solid #000; padding-top:1em;
                            padding-bottom:1em;" id="upload-{{condition|replace(" ", "-")}}">
                            <center><h4>{{ condition }}</h3></center>
                        </div>
                    </li>

                    {% endfor %}

                </ul>

            </div>

        </div>

        <script src="/static/js/vendor/jquery.js"></script>
        <script src="/static/js/foundation.min.js"></script>
        <script src="/static/js/jquery.simpleWeather.min.js"></script>
        <script src="/static/js/dropzone.js"></script>
        <script>

            $(document).foundation();

            {% for condition in conditions %}
            $("#upload-{{condition|replace(' ', '-')}}").dropzone({
                url: "/stream/{{condition}}",
                paramName: "clip",
                clickable: true,
                previewsContainer: ".previewsContainer",
                success: function(file, response) {
                    $("#upload-{{condition|replace(' ', '-')}}").fadeOut(500).fadeIn(500);
                }
            });
            {% endfor %}

            window.setInterval(function () {

                $.simpleWeather({
                    location: '{{ location }}',
                    woeid: '',
                    unit: 'f',
                    success: function(weather) {
                        $.ajax({
                            type: 'HEAD',
                            url: '/stream/' + weather.currently,
                            success: function() {
                                document.getElementById('player').src = '/stream/' + weather.currently;
                                document.getElementById('player').play();
                            },
                            error: function() {
                                alert("No stream for '" + weather.currently + "'!");
                            }
                        });
                        document.getElementById('info').innerHTML = "Currently " + weather.currently + " in {{ location }}";
                    },
                    error: function(error) {
                        console.log(error);
                    }
                });

            }, 3000);

        </script>

    </body>

</html>
